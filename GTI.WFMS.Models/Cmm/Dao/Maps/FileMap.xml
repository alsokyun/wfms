<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Main" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://ibatis.apache.org/mapping">
  <statements>



    <!-- 업무파일정보 목록	 -->
    <select id="SelectFileMapList"  resultClass="Hashtable">
      SELECT
        M.BIZ_ID
      , M.FIL_SEQ
      , M.TIT_NAM
      , M.GRP_TYP
      , M.CRE_USR, U.USER_NM
      ,case when length(M.CRE_YMD) = 8 then substr(M.CRE_YMD,1,4) || '-' || substr(M.CRE_YMD,5,2) || '-' || substr(M.CRE_YMD,7,2) else '' end  as CRE_YMD
      , M.UPD_USR
      , M.UPD_YMD
      , M.CTNT
      FROM FMS_FILE_MAP M
      LEFT JOIN INFOUSER.SYS_USER_INFO U ON M.CRE_USR = U.USER_ID
      WHERE 1=1
      AND M.BIZ_ID = #BIZ_ID#
      <isNotEmpty property="GRP_TYP">
        AND M.GRP_TYP = #GRP_TYP#
      </isNotEmpty>
      ORDER BY M.FIL_SEQ
    </select>


    <!-- 업무파일정보 목록	 -->
    <select id="SelectFileDtl"  resultClass="Hashtable">
      SELECT
      SEQ
      , FIL_SEQ
      , DWN_NAM
      , UPF_NAM
      , FIL_PTH
      , FIL_TYP
      , FIL_SIZ
      , FIL_RST
      , CUR_TFS
      , CRE_YMD
      , CRE_USR
      , UPD_YMD
      , UPD_USR
      FROM FMS_FILE_DTL
      WHERE 1=1
      AND FIL_SEQ = #FIL_SEQ#
    </select>
    
    
    
    <!-- 파일디테일 일괄삭제 -->
    <update id="DeleteFileSeq" parameterClass="Hashtable">
      DELETE FROM FMS_FILE_DTL WHERE 1=1
      AND FIL_SEQ = #FIL_SEQ#
    </update>


      <!-- 파일마스터 추가 -->
    <update id="InsertFileMst" parameterClass="Hashtable">
      <selectKey keyProperty="filSeq" resultClass="Integer">
        SELECT nvl(max(FIL_SEQ),0) +1 FROM FMS_FILE_MST
      </selectKey>

      <![CDATA[
			INSERT INTO FMS_FILE_MST 
				( FIL_SEQ
				  , FIL_NM
				  , CRE_YMD
				  , CRE_USR
				  , UPD_YMD
				  , UPD_USR )
			VALUES ( #filSeq#
				  , ''
				  , TO_CHAR(SYSDATE, 'yyyyMMdd')
				  , #id#
				  , TO_CHAR(SYSDATE, 'yyyyMMdd')
				  , #id# )
		]]>
    </update>


    <!-- 파일상세 추가 -->
    <update id="InsertFileDtl" parameterClass="Hashtable">
      <selectKey keyProperty="SEQ" resultClass="Integer">
        SELECT NVL(MAX(SEQ),0)+1 FROM FMS_FILE_DTL WHERE FIL_SEQ = #FIL_SEQ#
      </selectKey>

      <![CDATA[
			INSERT INTO FMS_FILE_DTL 
				( SEQ
				  , FIL_SEQ
				  , DWN_NAM
				  , UPF_NAM
				  , FIL_PTH
				  , FIL_TYP
				  , FIL_SIZ
				  , FIL_RST
				  , FIL_EXP
				  , CUR_TFS
				  , CRE_YMD )
			VALUES ( #SEQ#
				  , #FIL_SEQ#
				  , #DWN_NAM#
				  , #UPF_NAM#
				  , #FIL_PTH#
				  , #FIL_TYP#
				  , #FIL_SIZ#
				  , #FIL_RST#
				  , #FIL_EXP#
				  , '1'
				  , TO_CHAR(SYSDATE, 'yyyyMMdd') )
		]]>
    </update>


  </statements>
</sqlMap>